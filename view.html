<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>요청 상세 보기</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f7f9fb;
      padding: 20px;
      margin: 0;
    }
    h2 {
      margin-top: 0;
    }
    .box {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .node {
      border: 2px solid #0077ff;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
    }
    .connection {
      margin: 2px 0;
      padding: 5px;
      border-bottom: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <h2>요청 상세 보기</h2>
  <div class="box" id="summary"></div>
  <div class="box">
    <h3>📌 작업 목록</h3>
    <div id="nodes"></div>
  </div>
  <div class="box">
    <h3>🔗 연결 관계</h3>
    <div id="connections"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCnqVZV56XtsUfhk0sy9rqZ9OQcTPIwMC8",
      authDomain: "aure-64202.firebaseapp.com",
      projectId: "aure-64202",
      storageBucket: "aure-64202.firebasestorage.app",
      messagingSenderId: "702763581588",
      appId: "1:702763581588:web:6660893cf03de2e4bdb481"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app, "https://aure-64202-default-rtdb.asia-southeast1.firebasedatabase.app");

    const urlParams = new URLSearchParams(location.search);
    const id = urlParams.get("id");

    const summaryEl = document.getElementById("summary");
    const nodesEl = document.getElementById("nodes");
    const connectionsEl = document.getElementById("connections");

    get(ref(db, `requests/${id}`)).then((snapshot) => {
      const data = snapshot.val();

      if (!data) {
        summaryEl.innerText = "요청 데이터를 찾을 수 없습니다.";
        return;
      }

      summaryEl.innerHTML = `
        <strong>업무명:</strong> ${data.title}<br>
        <strong>부서:</strong> ${data.department}<br>
        <strong>반복 주기:</strong> ${data.repeat?.value} ${data.repeat?.unit}<br>
        <strong>1회 소요 시간:</strong> ${data.duration?.hour}시간 ${data.duration?.minute}분<br>
        <strong>설명:</strong> ${data.description}
      `;

      (data.nodes || []).forEach((node) => {
        const div = document.createElement("div");
        div.className = "node";
        div.innerHTML = `<strong>${node.title}</strong><br><small>${node.desc}</small><br><em>${node.duration}분</em>`;
        nodesEl.appendChild(div);
      });

      (data.connections || []).forEach((conn) => {
        const div = document.createElement("div");
        div.className = "connection";
        div.innerText = `#${conn.from} → #${conn.to}`;
        connectionsEl.appendChild(div);
      });
    });
  </script>
</body>
</html>
